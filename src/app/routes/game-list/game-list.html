<app-settings-panel
    [visible]="settingsVisible()"
    (closePressed)="hideSettings($event)"
/>

<app-header (settingsClicked)="showSettings()"></app-header>

@if(failed()) {
<div style="height: 200px"></div>
<div class="centered-div error-container">
    <h2>Error</h2>
    <p>{{errorMessage()}}</p>
</div>
}

@else if(!loaded()) {
<div style="height: 200px"></div>
<div class="centered-div">
    <h2>Loading...</h2>
</div>
}

@else {

<app-random-games-panel 
    [visible]="randomGamesVisible()"
    [games]="randomGames()"
    (closePressed)="hideRandomGames()"
/>

<div class="search-container">
    <input class="search-bar" [(ngModel)]="searchTerm" placeholder="Search games...">
    <!-- <input type="button" [(ngModel)]="filterNotPlayed" [value]="'nameFilter()'"> -->
    
    <button 
        class="btn-search-option" [ngClass]="{'toggled': filterNotPlayed()}" 
        (click)="filterNotPlayed.set(!filterNotPlayed())"
        title="Filter to show only games you haven't played yet."
    >📌Unplayed</button>
    
    <button 
        class="btn-search-option" (click)="showRandomGames()"
        title="Roll 3 random games from the list of games you haven't played yet."
    >🎲Random 3</button>
    
    <button 
        class="btn-search-option" (click)="progressTracker.clearProgress()"
        title="Reset all the 'played' checkboxes you've set, and clear them from local storage."
    >🗑️Clear Data</button>
    
    <!-- <form>
        <input name="searchTerm" [(ngModel)]="searchTerm" placeholder="Search games...">
        <br>
        <label for="filterNotPlayed">Only not played: </label>
        <input type="button" name="filterNotPlayed" [(ngModel)]="filterNotPlayed" value="nameFilter()">
    </form>
    <button (click)="progressTracker.clearProgress()">Clear Data</button> -->
</div>

<div style="height: 200px"></div>

<div class="game-list">
    @for(game of games() | filterGamesByName : searchTerm() | filterGamesByPlayed : false : filterNotPlayed(); track game.appid) {
        <app-game-list-item 
            [game]="game" 
            [played]="progressTracker.getPlayed(game.appid)"
            (playedChanged)="onPlayedChanged(game.appid, $event)"    
        />
    }
</div>

<div style="height: 64px"></div>

}

